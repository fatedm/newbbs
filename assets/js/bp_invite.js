(function(){var g=YAHOO.util,d=g.Event,f=g.Dom,b,a=true,e="",c={login:function(){if(TB.bom.getCookie("cookie1")==""&&TB.bom.getCookie("_l_g_")==""){f.setStyle("J_InvitePop","display","none");f.setStyle("J_InvitePop","visibility","hidden");if(!$("J_PopUpMask")){var h=document.createElement("div");h.id="J_PopUpMask";h.className="pop-up";h.style.position="absolute";h.style.left=f.getStyle("J_InvitePop","left");h.style.top=f.getStyle("J_InvitePop","top");f.setStyle(h,"z-index","100000");h.innerHTML='<div class=\'hd\'><h3 id=\'J_title\'></h3></div><div class="bd"><div class="inner"><iframe id="J_PopUpFrame" class="pop-mask" src="" scrolling="no" frameborder="0"></iframe></div></div><p class="ft"><a href="#" class="j_close act" >\u5173\u95ed</a></p>';document.body.appendChild(h);var j=f.get("J_PopUpFrame");f.setStyle(j,"height","auto");f.setStyle(h,"display","block");j.setAttribute("src","/invitation/sns_friends.htm?group_id="+b+"&t="+new Date().getTime());var k=f.getElementsByClassName("j_close");d.on(k,"click",function(l){f.setStyle(h,"display","none");f.setStyle("J_InvitePop","display","none");i.cancel();d.stopEvent(l)})}else{var h=$("J_PopUpMask")}f.setStyle(h,"display","block");var i=YAHOO.lang.later(1,window,function(){if((TB.bom.getCookie("cookie1")||TB.bom.getCookie("_l_g_"))!=""){f.setStyle(h,"display","none");c.viewAll();i.cancel();return true}},null,true);return true}return false},viewAll:function(){if(c.login()){return}var i="/invitation/sns_friends.htm?group_id="+b+"&t="+new Date().getTime();var h=g.Get.script(i,{onSuccess:function(r){if(!(typeof _result=="undefined")&&_result){var u=_result.groupList;var w=_result.friendList;var k=f.getElementsByClassName("f-area","div","J_InvitePop")[0];if(_result.message!=""){e=k.innerHTML;k.innerHTML="<p>"+_result.message+"</p>";return false}if(w.length==0){e=k.innerHTML;k.innerHTML='<p>\u8fd8\u53ea\u8eab\u4e00\u4eba\u5728\u6c5f\u6e56\u98d8\u7740\uff1f\u4f60\u76ee\u524d\u4e00\u4e2a\u597d\u53cb\u90fd\u6ca1\u6709\uff01\u5feb\u53bb<a href="'+$("J_InvitePop").getAttribute("data:jhurl")+'" target="_blank">\u9080\u8bf7\u597d\u53cb</a></p>';return false}if(!$("J_AllFri")&&e!=""){k.innerHTML=e;d.on("J_SureInvite","click",c.submitForm);var q=f.getElementsByClassName("act-cancel","button","J_InvitePop");d.on(q,"click",function(z){var y=d.getTarget(z);var j=f.getAncestorByClassName(y,"invite-f");f.setStyle(j,"display","none");d.preventDefault(z)})}$("J_AllGroup").innerHTML="";var p=document.createDocumentFragment();var m=document.createElement("option");m.setAttribute("value","all");m.appendChild(document.createTextNode("\u5168\u90e8\u597d\u53cb"));p.appendChild(m);for(var n=0;n<u.length;n++){_op=document.createElement("option");_op.setAttribute("value",u[n].groupId);_op.appendChild(document.createTextNode(u[n].groupName));p.appendChild(_op)}$("J_AllGroup").appendChild(p);d.on("J_AllGroup","change",c.changeGroup);$("J_AllFri").innerHTML="";var v=document.createDocumentFragment(),s;for(var l=0;l<w.length;l++){var o=document.createElement("li");o.setAttribute("data:fid",w[l].friendId);o.setAttribute("data:gid",w[l].groupIds);o.innerHTML='<label for="f_'+l+'"><input id="f_'+l+'" value="'+w[l].friendId+'" type="checkbox" />'+w[l].friendNick+"</label>";v.appendChild(o)}$("J_AllFri").appendChild(v);d.removeListener("c_all");var x=$("J_AllFri").getElementsByTagName("input");d.removeListener(x);d.on(x,"click",c.checkInput);var t=TB.form.CheckboxGroup.attach(x,{checkAllBox:"c_all",checkOnInit:true})}},onFailure:function(j){alert("\u672a\u77e5\u9519\u8bef")},charset:"GBK"});if(a){a=false;d.on("J_SureInvite","click",c.submitForm)}f.setStyle("J_InvitePop","visibility","visible");f.setStyle("J_InvitePop","display","block");f.setStyle("J_InvitePop","z-index","100000")},checkInput:function(){var i=f.getElementsBy(function(j){return f.isAncestor("J_AllFri",j)&&j.tagName.toLowerCase()=="input"&&f.getAncestorByTagName(j,"li").style.display!="none"});var h=TB.common.toArray(i).every(function(k,j){return k.checked==true});setTimeout(function(){h?($("c_all").checked=true):($("c_all").checked=false)},100)},changeGroup:function(l){var k=d.getTarget(l);var j=k.value;var h=f.get("J_AllFri").getElementsByTagName("li");if(j=="all"){f.setStyle(h,"display","block")}else{TB.common.toArray(h).forEach(function(n,m){f.setStyle(n,"display","block");if(n.getAttribute("data:gid").split(",").indexOf(j)<0){f.setStyle(n,"display","none")}})}var i=$("J_InvitePop").getElementsByTagName("input");TB.common.toArray(i).forEach(function(n,m){n.checked=false})},submitForm:function(k){d.preventDefault(k);if(c.login()){return}var j=$("J_AllFri").getElementsByTagName("input");var l=[];TB.common.toArray(j).forEach(function(n,m){f.getStyle(f.getAncestorByTagName(n,"li"),"display")!="none"&&n.checked==true&&l.push(n.value);f.getStyle(f.getAncestorByTagName(n,"li"),"display")=="none"&&(n.checked=false)});if(l.length==0){alert("\u8bf7\u9009\u62e9\u597d\u53cb");return}var h="friends="+l.join(",")+"&action=invitation_action&event_submit_do_invite_sns_friends=anything&groupId="+b+"&tbToken="+$("J_InvitePop").getAttribute("data:tbToken");var i=$("J_InvitePop").getAttribute("data:submitUrl")+"?_input_charset=utf-8";g.Connect.asyncRequest("POST",i,{success:function(o){var m=YAHOO.lang.JSON.parse(o.responseText);var n=f.getElementsByClassName("f-area","div","J_InvitePop")[0];e=n.innerHTML;m.result==0?(n.innerHTML='<p class="success">\u606d\u559c\u4f60\uff01\u5df2\u7ecf\u6210\u529f\u5411\u597d\u53cb\u53d1\u51fa\u9080\u8bf7\uff01</p>'):(n.innerHTML='<p class="error">'+m.result+"</p>");setTimeout(function(){location.reload(true)||location.reload()},3000)},failure:function(m){commonAjaxFailure(m)}},h)},init:function(){if(!$("J_InvitePop")){return}var i=f.getElementsByClassName(/act-close|act-cancel/,"*","J_InvitePop");d.on(i,"click",function(l){var k=d.getTarget(l);var j=f.getAncestorByClassName(k,"invite-f");f.setStyle(j,"display","none");f.setStyle(j,"visibility","hidden");d.preventDefault(l)});f.setStyle("J_InvitePop","visibility","hidden");var h=$("J_InviteFri")?$("J_InviteFri"):f.getElementsByClassName("J_InviteFri");d.on(h,"click",function(j){b=d.getTarget(j).getAttribute("data:groupId")});TB.widget.SimplePopup.decorate(h,"J_InvitePop",{position:"top",eventType:"click",width:390,align:"right",offset:[-150,-130],onShow:function(){setTimeout(function(){c.viewAll()},100)}})}};c.init()})();
