(function(){TB.namespace("Activity");var e=YAHOO.util,d=e.Dom,b=e.Event,c=window.document;TB.Activity.IptHint=function(){if(d.get("J_Tag")){TB.widget.InputHint.decorate("J_Tag",{hintMessage:"\u6d3b\u52a8\u5173\u952e\u5b57\uff0c\u7a7a\u683c\u6216\u9017\u53f7\u6216\u987f\u53f7\u9694\u5f00"})}if(d.get("J_PopupValidCode")){TB.widget.InputHint.decorate("J_PopupValidCode",{hintMessage:"\u70b9\u51fb\u8f93\u5165\u9a8c\u8bc1\u7801"})}}();TB.Activity.Calendar=function(){b.onContentReady("J_TimeHook",function(){TB.namespace("CalendarTime");var h=new Date().getTime();var g=h+180*24*3600*1000;var j=function(n){var l=new Date();l.setTime(n);var o=l.getFullYear(),k=((l.getMonth()+1)<10?"0"+(l.getMonth()+1):(l.getMonth()+1)),n=l.getDate()<10?"0"+l.getDate():l.getDate();return o+"-"+k+"-"+n};var f=j(h),i=j(g);TB.CalendarTime.RangeTime=TB.widget.SimpleCalendar.initRange(["J_TimeOn","J_TimeTo"],null,null,{mindate:f,maxdate:i,navigator:true,autoMoveToNext:true})})}();TB.namespace("Daypartition");TB.Daypartition["int"]=function(u,v,w){var r=24*60;var o=[];var t=function(){var s=new Date(),p=s.getHours(),i=s.getMinutes();return(p.toString().length==1?"0"+p:p)+":"+(i.toString().length==1?"0"+i:i)};if(/\./.test(r/v)&&v<=0){throw new Error("section\u53c2\u6570\u4e0d\u5408\u6cd5\uff0c\u4e0d\u80fd\u4e3a\u8d1f\u6570\u6216\u8005\u4e0d\u88ab\u4e00\u5929\u6574\u9664\u7684\u5206\u949f\u6570");return}o.length=r/v;o[0]=0;for(var k=1;k<o.length;k++){o[k]=o[k-1]+v}var q=[];var n=t().split(":")[0],j=t().split(":")[1];for(var k=0;k<o.length;k++){o[k]=(o[k]/60);var l,x;l=Math.floor(o[k]);x=(o[k]-l)*60;o[k]=(l.toString().length==1?"0"+l:l)+":"+(x.toString().length==1?"0"+x:x);var f=document.createElement("option");f.value=o[k];f.innerHTML=o[k];var l=o[k].split(":")[0],g=o[k].split(":")[1];d.get(u).appendChild(f);if(l==n){if(g==j){d.get(u).value=o[k]}else{q.push(o[k])}}}setTimeout(function(){if(w!=""){d.get(u).value=w}},5)};var a=d.get("J_Money");b.on("J_MoneyRadio1","click",function(f){a.value=""});b.on("J_MoneyRadio2","click",function(f){a.focus()});b.on("J_Money","focus",function(f){d.get("J_MoneyRadio2").checked=true});b.on("J_Activity","submit",function(f){if(d.get("J_Tag").value=="\u6d3b\u52a8\u5173\u952e\u5b57\uff0c\u7a7a\u683c\u6216\u9017\u53f7\u6216\u987f\u53f7\u9694\u5f00"){d.get("J_Tag").value=""}});TB.Activity.Uploadpic=function(){var l,i,C=true,p=false,v=["J_CloseBtn","J_CancelBtn"],o=new e.popup("J_UploadBtn","J_Incision",v)["int"](),j=d.get("J_BrowseText"),u=d.get("J_UpTips"),F=d.get("uploadform"),z=d.get("J_ScreenBig"),y=d.get("preview-img"),k=d.get("J_FileHide"),E=[".jpg",".gif",".png",".jpeg"],A=F.action,s,B,m,g=null,x=function(){j.value="";k.value="";if(!p){z.innerHTML="";y.innerHTML=""}},D=function(w,h){u.innerHTML=w;if(h=="error"){d.addClass(u,"error-tip uptips")}else{if(h=="success"){d.removeClass(u,"error-tip uptips")}}},f=function(Q){var O=i.getCropCoords();var h=O.height,I=O.width,K=O.top,P=O.left,N=(B*160)/h,w=(s*160)/I,H=(N*K)/B,J=(w*P)/s;if(B<=160||s<=160){var L=Math.min(B,s);var M=(160-L)/2;var G=l.style;G.height=B+"px";G.width=s+"px";G.top=(M-K)+"px";G.left=(M-P)+"px";G.clip="rect("+K+"px "+(L+P)+"px "+(L+K)+"px "+P+"px)"}else{var G=l.style;G.height=N+"px";G.width=w+"px";G.top=-H+"px";G.left=-J+"px"}if(Q){return O}},n={upload:function(G){if(G.responseText!=undefined){D("\u652f\u6301JPG,JPEG,PNG,GIF\u56fe\u7247\u683c\u5f0f,\u4e14\u56fe\u7247\u5c0f\u4e8e1M","success");var w=YAHOO.lang.JSON.parse(G.responseText);if(w.status==0){var h="<img src="+w.imgUrl+'_310x310.jpg id="cropper">'}else{D(w.error,"error");z.innerHTML="";return}d.get("J_ScreenBig").focus();z.innerHTML=h;y.innerHTML=h;y.getElementsByTagName("img")[0].id="copr160";l=d.get("copr160"),m=d.get("cropper");m.onload=function(){B=m.offsetHeight,s=m.offsetWidth;if(B<=160&&s<=160){l.style.left=(160-m.offsetWidth)/2+"px";l.style.top=(160-m.offsetHeight)/2+"px";return null}var K=160,I=160,L=160,J=160;if(B<=160||s<=160){K=I=L=J=Math.min(B,s)}i=new YAHOO.widget.ImageCropper("cropper",{initialXY:[0,0],minHeight:K,minWidth:I,initHeight:L,initWidth:J,status:false,ratio:true,shiftKeyTick:10});if(6==YAHOO.env.ua.ie){var H=d.getElementsByClassName("yui-crop-mask")[0];H.style.height=B+"px"}f();i.on("moveEvent",function(){f()});i.on("resizeEvent",function(){f()});i._resize.on("endResize",function(){var N=arguments[0];if(N.width!=N.height){var M=Math.min(N.width,N.height);this.resize(null,M,M,0,0);if(!g){g=this.on("dragEvent",function(){i._setConstraints(true)})||true}}})}}},timeout:5000,failure:function(h){D("\u4e0a\u4f20\u8bf7\u6c42\u8d85\u65f6","error");z.innerHTML="";x()}},q=function(){j.value=this.value;var h=k.value,w=h.lastIndexOf("."),H=h.substring(w,h.length).toLowerCase(),G=false;E.forEach(function(I){if(H==I){G=true}});if(!G){D("\u5e2e\u6d3e\u4ec5\u652f\u6301jpg/jpeg/gif/png\u683c\u5f0f\u7684\u56fe\u7247","error");x();return}z.innerHTML="<p class='loadingbar'>\u56fe\u7247\u4e0a\u4f20\u4e2d<br/><img src='http://img04.taobaocdn.com/tps/i4/T1ie4OXi4GXXXXXXXX-95-7.gif'></p>";e.Connect.setForm(F,true,true);e.Connect.asyncRequest("POST",A,n)};b.on(v,"click",x);var r=new e.YUILoader({require:["imagecropper"],loadOptional:true,onSuccess:function(){b.on(k,"change",q)},timeout:10000,combine:true});r.insert();var t=function(){if(C){if(z.getElementsByTagName("img").length!=0){C=false;var H={upload:function(L){if(L.responseText!=undefined){D("\u652f\u6301JPG,JPEG,PNG,GIF\u56fe\u7247\u683c\u5f0f,\u4e14\u56fe\u7247\u5c0f\u4e8e1M","success");var K=YAHOO.lang.JSON.parse(L.responseText);if(K.status==0){var J=c.createElement("img");J.src=K.imgUrl;J.alt="";o.hide();var I=d.get("upload-img");I.removeChild(I.getElementsByTagName("img")[0]);I.appendChild(J);d.get("J_UploadBtn").value="\u7f16\u8f91\u6d3b\u52a8\u6d77\u62a5";d.get("J_LogoUrl").value=K.imgUrl;p=true;C=true}else{D(K.error,"error");z.innerHTML="";return}}},timeout:5000,failure:function(I){D("\u622a\u56fe\u7a0b\u5e8f\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u4fdd\u5b58","error");z.innerHTML="";x()}};var G=d.get("J_SavePic"),w=G.action;if(i){if(m.offsetHeight>160&&m.offsetWidth>160){d.get("J_AvatarUrl").value=i.getCropCoords().image;d.get("J_AvatarWidth").value=i.getCropCoords().width;d.get("J_AvatarHeight").value=i.getCropCoords().height;d.get("J_AvatarTop").value=i.getCropCoords().top;d.get("J_AvatarLeft").value=i.getCropCoords().left}else{if(m.offsetHeight<=160||m.offsetWidth<=160){var h=Math.min(i.getCropCoords().width,i.getCropCoords().height);d.get("J_AvatarUrl").value=i.getCropCoords().image;d.get("J_AvatarWidth").value=h;d.get("J_AvatarHeight").value=h;d.get("J_AvatarTop").value=i.getCropCoords().top;d.get("J_AvatarLeft").value=i.getCropCoords().left}}}else{d.get("J_AvatarUrl").value=m.src;d.get("J_AvatarWidth").value=160;d.get("J_AvatarHeight").value=160;d.get("J_AvatarTop").value=0;d.get("J_AvatarLeft").value=0}if(m.offsetHeight<=160&&m.offsetWidth<=160){d.get("J_AvatarUrl").value=m.src;d.get("J_AvatarWidth").value=160;d.get("J_AvatarHeight").value=160;d.get("J_AvatarTop").value=0;d.get("J_AvatarLeft").value=0}e.Connect.setForm(G,true,true);e.Connect.asyncRequest("POST",w,H)}else{D("\u4f60\u8fd8\u672a\u4e0a\u4f20\u56fe\u7247\uff0c\u65e0\u6cd5\u4fdd\u5b58","error")}}};b.on("J_SaveBtn","click",t)}()})();
