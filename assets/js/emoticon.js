TB.widget.SimpleEmoticon=(function(){var c=YAHOO.util,h=c.Dom,f=c.Event,b=YAHOO.lang,g=oList=null;var e={emotelist:"http://a.tbcdn.cn/app/matrix/js/emoticon_list.js?"+new Date().getTime()+".js",catchType:"ubb",clickOff:false,trigger:"J_Emote",container:"J_EmoteImg",textarea:"J_MessageContent"};var a={};a._beforeProcess=function(){return true};a._afterProcess=function(){};var d=function(){var j=this,k=j.config;if(!this._beforeProcess()){return}for(var l=0;l<oList.length;l++){g.innerHTML+='<a href="'+oList[l]["url"]+'" ubb="'+oList[l]["ubb"]+'" title="'+oList[l]["title"]+'" />'}this.popup.appendChild(g);f.on(this.popup,"click",function(i){f.stopEvent(i);var m=f.getTarget(i);if(m.tagName=="A"){h.get(k.textarea).value+=k.catchType=="ubb"?m.getAttribute("ubb"):'<img src="'+m.getAttribute("href")+'" alt="'+m.getAttribute("title")+'" />';k.clickOff&&j.hide()}});f.on(document,"click",function(i){var m=f.getTarget(i);if(m==j.trigger){return true}else{if(!(m==j.popup)){j.hide()}}});this._afterProcess()};return{decorate:function(i){a.config=b.merge(e,i||{},true);var j=TB.widget.SimplePopup.decorate(a.config.trigger,a.config.container,{autoFit:true,eventType:"click",onShow:function(){var l=this.popup,p=l.parentNode,o=null,m=this;if(p!=document.body){this.popup=o=l.cloneNode(true);p.removeChild(l);document.body.appendChild(o);g=document.createElement("DIV");g.className="emote-inner";var q={getCookie:function(s){var r=document.cookie.match("(?:^|;)\\s*"+s+"=([^;]*)");return(r&&r[1])?decodeURIComponent(r[1]):""}};var k=q.getCookie("_nk_");var n=q.getCookie("_l_g_")&&k;if(typeof(a.config.emotelist)=="string"){c.Get.script(a.config.emotelist,{onSuccess:function(){if(n){oList=EmoticonList}else{oList=EmoticonList2}d.apply(m)}})}else{oList=a.config.emotelist;d.call(this)}}}});b.augmentObject(a.config,j.config,true);b.augmentObject(j,a,true);return j}}})();
