(function(){var c=YAHOO,b=c.util.Dom,a=c.util.Event;c.widget.actlayer=function(i,e,v){var m=this;m.btn=i;m.type=e;m.config=v;var h=function(z){var x="";for(var y=0;y<z.length;y++){var A=z.charCodeAt(y);if(A==12288){x+=String.fromCharCode(32);continue}if(A>65280&&A<65375){x+=String.fromCharCode(A-65248);continue}x+=String.fromCharCode(A)}return x};var g=function(x){var x=TB.common.parseUri(x);return x.prePath+x.path};var d=function(z){var B={action:"bangpai/activity_action",groupId:m.config.groupId,threadId:m.config.threadId,_input_charset:"utf_8"};var A=function(C,E){for(var D in E){if(!C.hasOwnProperty(D)){C[D]=E[D]}}return C};var y=function(C){var E="";for(var D in C){E+=D+"="+C[D]+"&"}return E.slice(0,E.length-1)};var x={canido:function(D){var C={event_submit_do_can_join_activity:"anything"};var E=A(B,C);return y(E)},dojoin:function(D){var C={event_submit_do_user_join_activity:"anything"};C[m.config.tbTokenFieldName]=m.config.tbToken;C[m.config.phoneFieldName]=b.get("affirmact-popup-phone")?h(b.get("affirmact-popup-phone").value):"";if(m.config.needCheckcode=="true"){C[m.config.checkcodeFieldName]=b.get("popup-validCode").value}var E=A(B,C);return y(E)},exit:function(){var C={event_submit_do_exit_activity:"anything"};C.tbToken=m.config.tbToken;var D=A(B,C);return y(D)}};return x[z]()};var f={affirmact:function(x){r(x.target,x.title,x.money,x.actTime,x.phone,x.verifyCodeUrl,x.needCheckcode)}};var w=function(x){t(m.config.target,"\u8bbf\u95ee\u8d85\u65f6");c.util.popup(m.btn,m.config.target,["mypopup-close","sub-close"])["fire"]()};var j={success:function(y){if(y.responseText!=""){var x=YAHOO.lang.JSON.parse(y.responseText);if(x.hasOwnProperty("resultCode")&&x.resultCode=="CSRF_INVALID"){t(m.config.target,x.erMsg);c.util.popup(m.btn,m.config.target,["mypopup-close","sub-close"])["fire"]();a.on("mypopup-close","click",function(){b.get(m.config.target).innerHTML="";window.location.reload()})}else{window.location.reload()}}},failure:w,timeout:5000};var p={success:function(E){if(E.responseText!=""){var D=YAHOO.lang.JSON.parse(E.responseText);if(D.isSuccess=="true"){q();u(m.config.target,m.config.constitutor,"success");o()}else{if(D.hasOwnProperty("redirectURL")){window.location.href=D.redirectURL;return null}if(b.get("validCode-tip")){var B=b.get("validCode-tip")}if(x=b.get("phone-tip")){var x=b.get("phone-tip")}if(D.hasOwnProperty("formErMsg")){var A=D.formErMsg;var z=function(F){if(!F){t(m.config.target,"\u5bf9\u4e0d\u8d77\uff0c\u6d3b\u52a8\u4fe1\u606f\u5df2\u66f4\u65b0\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u65b0\u63d0\u4ea4");a.on("mypopup-close","click",function(){window.location.reload()})}else{F.innerHTML=A[y];b.removeClass(F,"hidden")}};var C={phoneNum:function(){z(x)},checkcode:function(){z(B);b.batch(b.getElementsByClassName("J_validCode"),function(F){F.src=F.src+"r="+new Date().valueOf()})},tbToken:function(){q();u(m.config.target,m.config.constitutor,"error",A[y]);o();a.on("mypopup-close","click",function(){window.location.reload()})}};for(var y in A){C[y]()}}if(D.hasOwnProperty("erMsg")){q();u(m.config.target,m.config.constitutor,"error",D.erMsg);o();a.on(["mypopup-close","sub-close"],"click",function(){window.location.reload()})}}}},failure:w,timeout:5000};var s={success:function(y){if(y.responseText!=""){var x=YAHOO.lang.JSON.parse(y.responseText);if(x.isSuccess=="false"){if(x.hasOwnProperty("redirectURL")){window.location.href=x.redirectURL}else{if(x.hasOwnProperty("erMsg")){t(m.config.target,x.erMsg);c.util.popup(m.btn,m.config.target,["mypopup-close","sub-close"])["fire"]();a.on("mypopup-close","click",function(){b.get(m.config.target).innerHTML="";window.location.reload()})}}}else{k()}}},failure:w,timeout:5000};var l=function(){var x=d("canido");c.util.Connect.asyncRequest("POST",g(window.location.href),s,x)};var n=function(){var y=this;var z=m.config.target;var x={validCodetip:{failmsg:"\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a"},phonetip:{failmsg1:"\u7535\u8bdd\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a",failmsg2:"\u8054\u7cfb\u7535\u8bdd\u53ea\u80fd\u7531\u6570\u5b57,-,\u7a7a\u683c,(,)\u7ec4\u6210\u3002"},ruletip:{failmsg:"\u8bf7\u52fe\u9009\u6dd8\u5b9d\u7f51\u6d3b\u52a8\u534f\u8bae"}};a.delegate(z,"click",function(D,C,A){var B=b.get("J_CodeImg");B.src=B.src+"r="+new Date().valueOf()},"a.J_RfreshValidation");if(b.get("popup-term")){TB.widget.InputHint.decorate("popup-term",{hintMessage:x.term.msg})}a.delegate(z,"click",function(E,G,B){if(b.get("popup-validCode")){var D=b.get("popup-validCode").value}if(b.get("validCode-tip")){var C=b.get("validCode-tip")}var F=b.get("popup-rule").checked,H=b.get("rule-tip");var I={affirmact:function(){var L=true;if(b.get("affirmact-popup-phone")){var K=b.get("phone-tip"),J=h(b.get("affirmact-popup-phone").value);if(J==""){b.removeClass(K,"hidden");K.innerHTML=x.phonetip.failmsg1;L=false}else{if(/[^\d|\(|\)|\-|\s]/.test(J)){b.removeClass(K,"hidden");K.innerHTML=x.phonetip.failmsg2;L=false}else{b.addClass(K,"hidden")}}}if(D==""||D=="\u70b9\u51fb\u8f93\u5165\u9a8c\u8bc1\u7801"){b.removeClass(C,"hidden");C.innerHTML=x.validCodetip.failmsg;L=false}else{b.addClass(C,"hidden")}if(F==""){b.removeClass(H,"hidden");b.setStyle(H,"display","inline");b.setStyle(H,"float","none");H.innerHTML=x.ruletip.failmsg;L=false}else{b.addClass(H,"hidden")}return L}};if(!I[m.type]()){return}var A=d("dojoin");c.util.Connect.asyncRequest("POST",g(window.location.href),p,A)},"input#popup-sub")};var q=function(){a.purgeElement(m.config.target,true)};var o=function(){var x=b.get(m.config.target);c.util.popup(m.btn,m.config.target,["mypopup-close","sub-close"])["fire"]();a.on(["mypopup-close","sub-close"],"click",function(){b.get(m.config.target).innerHTML=""})};var k=function(){q();f[e](m.config);o()};var u=function(A,D,x,E){if(x=="success"){var y='<div class="success-icon"></div>',C="\u6d3b\u52a8\u62a5\u540d\u6210\u529f",B='<p class="ft20 p80">\u606d\u559c\u4f60\uff0c\u53c2\u52a0\u6d3b\u52a8\u6210\u529f\uff01 </p><p class="p80">\u8bf7\u4e0e\u6d3b\u52a8\u53d1\u8d77\u8005 '+D+' <span class="J_WangWang" data-display="inline" data-nick="'+D+'" id="newdog"></span>  &nbsp;\u53ca\u65f6\u8054\u7cfb\uff0c\u4ee5\u4fbf\u80fd\u591f\u6309\u65f6\u987a\u5229\u5730\u53c2\u52a0\u6d3b\u52a8\uff01</p>'+y}else{if(x=="error"){var y='<div class="error-icon"></div>',C="\u6d3b\u52a8\u62a5\u540d\u5931\u8d25";msg=E,B='<p class="ft35 p80">'+msg+"</p>"+y}}var z='<form id="affirmact" class="tacitly-actpopup msg"><div class="act-top"><h3 class="oneline notarize">'+C+'</h3><s title="\u5173\u95ed" id="mypopup-close">&times;</s></div><div id="affirmact-content" class="content">'+B+'</div><div class="act-foot"><input type="button" value="\u5173 \u95ed" class="sub-t" title="\u5173\u95ed" id="sub-close"></div></form>';b.get(A).innerHTML=z;TB.ww.lightByIcon(b.get("newdog"));a.on(["mypopup-close","sub-close"],"click",function(){window.location.reload()})};var r=function(E,H,y,D,G,C,x){var F=G=="true"?'<p>\u8054\u7cfb\u7535\u8bdd\uff1a<input type="text" id="affirmact-popup-phone" maxlength="20"><span class="error hidden" id="phone-tip"></span></p>':"";var A=x=="true"?'<p style="text-indent:12px;"><span class="actcode">\u9a8c\u8bc1\u7801\uff1a</span><input type="text" id="popup-validCode" maxlength="4"> <img src="'+C+'" width="100" height="37" class="J_validCode hidden" id="J_CodeImg"> <span class="sup hidden" id="J_CodeTip">\u770b\u4e0d\u6e05\uff1f<a href="" onclick="return false;" class="J_RfreshValidation" target="_blank">\u6362\u4e00\u5f20</a></span> <span class="error hidden" id="validCode-tip"></span></p>':"";var J='<form id="affirmact" class="tacitly-actpopup msg"><div class="act-top"><h3 class="oneline">\u6d3b\u52a8\u62a5\u540d\u7533\u8bf7\uff1a'+H+'</h3><s title="\u5173\u95ed"  id="mypopup-close">&times;</s></div><div id="affirmact-content" class="content"><p class="ft20">\u6d3b\u52a8\u65f6\u95f4\uff1a'+D+"</p><p>\u4eba\u5747\u8d39\u7528\uff1a"+y+" </p>"+F+A+'<p class="rule-p"><input type="checkbox" id="popup-rule" checked="checked"> \u63a5\u53d7\u6dd8\u5b9d\u7f51<a href="http://bangpai.taobao.com/group/thread/12011-20118749.htm" target="_blank">\u5e2e\u6d3e\u6d3b\u52a8\u514d\u8d23\u534f\u8bae</a> <span class="error hidden" id="rule-tip"></span></p></div><div class="act-foot"><input type="button" value="\u786e\u5b9a\u62a5\u540d" class="sub-f" title="\u786e\u5b9a\u62a5\u540d" id="popup-sub"></div></form>';b.get(E).innerHTML=J;n();if(x=="true"){TB.widget.InputHint.decorate("popup-validCode",{hintMessage:"\u70b9\u51fb\u8f93\u5165\u9a8c\u8bc1\u7801"});var B=b.get("J_CodeImg"),I=b.get("J_CodeTip"),z=false;a.on("popup-validCode","focus",function(){b.removeClass(B,"hidden");b.removeClass(I,"hidden");if(!z){B.src=B.src+"r="+new Date().valueOf();z=true}})}};var t=function(y,z){var x='<div class="popup-tips"><div class="tips-top" id="mypopup-close"><h4>\u5c0f\u63d0\u793a</h4><s title="\u5173\u95ed">&times;</s></div><div class="tips-content"></div></div>';b.get(y).innerHTML=x;b.getElementsByClassName("tips-content","div")[0].innerHTML=z;a.on("mypopup-close","click",function(){b.get(y).innerHTML=""})};return{intbind:function(){var x=this;a.on(i,"click",function(){if(b.hasClass(i,"surrender")){var z="\u60a8\u771f\u7684\u786e\u5b9a\u8981\u653e\u5f03\u53c2\u52a0\u6d3b\u52a8\u5417\uff1f";if(confirm(z)==true){var y=d("exit");c.util.Connect.asyncRequest("POST",g(window.location.href),j,y)}else{return false}}else{l()}})}}}})();
