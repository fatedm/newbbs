KISSY.app("Detail");Detail.add("fixHover",function(a){function b(f,c){var d=KISSY;if(f){d.Event.on(f,"mouseenter mouseleave",function(h){var g="mouseenter"===h.type?"add":"remove";d.DOM[g+"Class"](h.target,"hover");if(c){d.DOM[g+"Class"](d.DOM.parent(h.target,c),"phover")}})}}return a.fixHover=b});Detail.add("zhuwei",function(c){var b=KISSY.DOM,a=KISSY.Event;a.on(".J_zhuweiBtns","click",function(f){f.halt();var d=b.attr(f.target,"data-url");Detail.overlay.showDialog({src:d,width:345,headerContent:"\u52a9\u5a01"})})});Detail.add("zhuwei_success",function(b){var f=KISSY.DOM,d=KISSY.Event;function c(g){a(g,g.zhuweiId);if(f.get("#"+g.zhuweiId+"-top")){a(g,g.zhuweiId+"-top")}}function a(n,k){var g=f.get("#"+k+" .J_zhuweiList");if(!g){return}var j=f.get("#"+k+" .J_zhuweiTables");if(!j){return}var l=f.get("#"+k+" .zhuweicounts");var m=f.query("tr",j),i;f.css(g,"display","block");if(n.zhuweiId=="replay0"){i=5}else{i=3}if(m.length>=i){j.deleteRow(i-1)}if(m.length==0){var h=j.insertRow(0);h.insertCell(0).className="username";h.insertCell(1);h.insertCell(2).className="content"}else{var h=m[0].cloneNode(true);m[0].parentNode.insertBefore(h,m[0])}if(n.coin>0){h.cells[1].className="plus"}else{h.cells[1].className="neg"}h.cells[0].innerHTML="<a target='_blank' href='"+n.userCenterLink+"'>"+n.username+"</a>";h.cells[1].innerHTML="<s></s>"+n.coin;h.cells[2].innerHTML=n.content;l.innerHTML=l.innerHTML*1+n.coin*1;b.overlay.hide()}return b.zhuweiSuccess=c});Detail.add("collect",function(a){var b=KISSY.DOM.attr("#J_collection","data-url");if(!b){return}KISSY.Event.on("#J_collection","click",function(c){c.halt();a.overlay.showDialog({src:b,width:345,headerContent:"\u6536\u85cf"})})});Detail.add("vote",function(){var b=KISSY,d=b.DOM,c=b.Event,f=function(k){for(var j=0,h=0,g=k.length;h<g;h++){k[h].checked&&j++}return j},a=function(j){var o="",n,m,g,k,h=document.getElementById("choiceForm").getElementsByTagName("*");for(m=0,g=h.length;m<g;m++){n=h[m];if(n.name){k=n.type&&n.type.toLowerCase();if(k==="checkbox"||k==="radio"){if(!n.checked){continue}}o+="&"+n.name+"="+n.value}}return j+"?"+o.substring(1)};Detail.vote=function(h,g){var j=d.query("#J_vote input"),i=0;c.on(j,"click",function(){if(f(j)>h){this.checked=false;alert("\u6700\u591a\u53ea\u80fd\u9009\u62e9"+h+"\u9879")}});c.on("#J_submit","click",function(k){k.halt();var l=new Date().getTime();if(l-i<2000){return}i=l;if(f(j)===0){alert("\u55e8\uff0c\u4f60\u5230\u5e95\u6295\u7968\u7ed9\u54ea\u4e00\u9879\u5440\uff1f")}else{Detail.overlay.showDialog({src:a(g),width:345,headerContent:"\u6295\u7968"})}})}});Detail.add("overlay",function(b){var c=KISSY,g=c.DOM,f,a,d;b=b.overlay={showDialog:function(h){h=h||{};c.use("overlay,dd",function(){if(!f){f=new c.Dialog({width:h.width||345,headerContent:h.headerContent||"",bodyContent:'<iframe id="dialogFrm" src="'+h.src+'" width="'+(h.width-2||343)+'" height="250" frameborder="0" scrolling="no"></iframe>',draggable:true,mask:true,zIndex:10003});f.render()}else{g.attr("#dialogFrm","src",h.src);if(h.width){f.set("width",h.width);g.attr("#dialogFrm","width",h.width-2)}h.headerContent&&f.set("headerContent",h.headerContent)}b.hide();setTimeout(function(){if(!d){b.hide();f.center();f.show()}},500)})},hide:function(){f&&f.hide();a&&a.hide()},showMessage:function(i,h,j){c.use("overlay,dd",function(){if(!a){if(6===c.UA.ie){a=new c.Overlay({width:360})}else{a=new c.Overlay()}a.render();a.get("contentEl").addClass("msg24")}a.get("contentEl").html(i);b.hide();a.center();a.show();d=true;h&&setTimeout(function(){b.hide();j&&(location.href=location.href.split("#")[0]);d=false},h)})},setWidth:function(h){if(f){f.set("width",h);g.attr("#dialogFrm","width",h-2);f.center()}},setHeight:function(h){if(f){f.set("height",h);g.attr("#dialogFrm","height",h-2);f.center()}}}});(function(){var c=KISSY,d=c.DOM,f=d.get("#J_vote"),a,b;if(d.attr(f,"data-votable")==="true"){a=d.attr(f,"data-maxanswer");b=d.attr(f,"data-url");Detail.vote(a,b)}if(6===c.UA.ie){Detail.fixHover(d.query(".J_userHead"),".user-info");Detail.fixHover(d.get("#J_publish"));Detail.fixHover(d.query(".J_sort"))}})();KISSY.use("datalazyload",function(a){new a.DataLazyload({mod:"auto"})},{order:true});function deleteThread(){if(window.confirm("\u4f60\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5e16\u5b50\uff1f\u5220\u9664\u4e4b\u540e\u4e0d\u80fd\u6062\u590d\u54e6\uff01")){var a=KISSY.DOM.get("#deleteThreadForm");a.submit()}}function sinkThread(){var a=KISSY.DOM.get("#sinkThread");a.submit()}function floatThread(){var a=KISSY.DOM.get("#floatThread");a.submit()}function deleteReply(a){if(window.confirm("\u4f60\u786e\u8ba4\u8981\u5220\u9664\u8be5\u56de\u590d\uff1f\u5220\u9664\u4e4b\u540e\u4e0d\u80fd\u6062\u590d\u54e6\uff01")){var b=KISSY.DOM.get("#replyForm");b.replyId.value=a;b.submit()}}KISSY.ready(function(b){var g=b.DOM,c=b.Event,f,a=g.get("#J_FastReply")?[]:g.query(".replyArea");f=g.get("#quick_hf");f&&a.push(f);f=g.get("#topreply");f&&a.push(f);c.on(a,"click",function(i){window.location.href="#publishreply";i.halt()});var d=g.attr("#whitelist","value"),h;if(d){d=d.split("_");b.use("sizzle",function(){b.each(g.query(".substance img"),function(i){try{var l=g.attr(i,"src")||g.attr(i,"data-ks-lazyload"),j=l.split("/")[2].split(":")[0],m=false;b.each(d,function(n){if(j.substring(j.length-n.length)===n){m=true;return false}});if(!m){g.attr(i,{src:"http://img07.taobaocdn.com/tps/i7/T1aoxtXhtCXXXXXXXX-170-120.jpg",width:170,height:120});g.css(i,"display","inline")}}catch(k){}})})}});(function(){if(!!KISSY.UA.ie&&KISSY.UA.ie<9){var b=KISSY,f=b.DOM,d=b.Event,a=f.get(".J_SubChannel"),c;if(!a){return}else{c=f.children(a,".ext-sub-channel-selected")[0]}b.each(f.children(a,"a"),function(i){var h=f.create("<span>"),g=f.create("<span>");f.css(i,"position","relative");f.addClass(h,"ext-channel-item-l");f.append(h,i);f.addClass(g,"ext-channel-item-r");f.append(g,i)});d.on(a,"mouseover",function(g){if(g.target.tagName.toLowerCase()==="a"&&g.target!==c){f.addClass(g.target,"ext-sub-channel-selected")}});d.on(a,"mouseout",function(g){if(g.target.tagName.toLowerCase()==="a"&&g.target!==c){f.removeClass(g.target,"ext-sub-channel-selected")}})}})();KISSY.add("citation",function(a){var f=a.DOM,d=a.Event,c=a.Node.all;function b(g){this.trigger=f.query(g);this.init()}a.augment(b,{init:function(){this.click()},click:function(){if(!this.trigger.length){return}a.each(this.trigger,function(g){d.on(g,"click",function(){var h=f.parent(f.parent(g,"p"),2),i=f.next(h,".citation");f.remove(h);f.css(i,"display","block")})})}});a.ready(function(g){new b(".slide-citation")});return b});KISSY.add("fixed",function(b){var d=b.DOM,c=b.Event;function a(m){if(!d.get(m)){return}c.on(d.get(m),"click",function(n){n.preventDefault();window.scroll(0,0)});if(b.UA.ie!=6){c.on(window,"scroll resize",function(){var n=d.scrollTop();if(n>10){d.css(m,"display","block")}else{d.css(m,"display","none")}});return}var i=d.get(m),g=d.height("#content"),f=d.viewportHeight(),k=d.offset("#content"),h=k.top,j=f-h-115,l=g-j;d.css(i,"bottom",l);c.on(window,"scroll resize",function(){var o=d.scrollTop();if(o>10){d.css(i,"display","block");var n=l-d.scrollTop();n=n>-217?n:-217;d.css(i,"bottom",n+"px")}else{d.css(i,"display","none")}})}b.ready(function(f){a("#toTop")});return a});try{SNS.ui("sharebtn",{element:"#sns-widget-sharebtn",skinType:"2",title:"\u6dd8\u5b9d\u8bba\u575b",app_id:"12076894",comment:document.title})}catch(e){}KISSY.add("tag",function(a){var d=a.DOM,c=a.Event,f=a.UA.ie===6?1:0;function b(){if(!d.get("#tags-edit")){return}this.init()}a.augment(b,{allTags:[],exitTags:[],init:function(){this.getAllTags();this.getExitTags();this.render();this.editStart();this.click();this.submit()},getAllTags:function(){var g=this;if(!d.get("#tms-tags p")){return}a.each(d.query("#tms-tags p"),function(h){g.allTags.push(d.html(h))})},getExitTags:function(){var g=d.get(".the-tags"),h=d.query("a",g)||[],k,i=this.allTags.length,j=this;if(!i||!h.length){d.hide(g);return}a.each(h,function(m){var l=d.html(m);for(k=0;k<i;k++){if(l==j.allTags[k]){j.exitTags.push(l)}}});d.val("#J_Tags",j.exitTags.join(" "))},editStart:function(){if(!d.get(".tags-edit-trigger")){return}var g=this;c.on(d.get(".tags-edit-trigger"),"click",function(){if(d.css("#tags-edit","display")==="block"){d.css("#tags-edit","display","none")}else{if(!g.allTags.length){alert("TMS\u5f15\u5165\u5931\u8d25");return}d.css("#tags-edit","display","block")}})},render:function(){var g=d.get("#tags-edit .tags-edit-box"),p="",s=[],r=this.exitTags,t=this.allTags;if(t.length==0){return}if(!r.length){s=t}else{for(var k=0,h=t.length;k<h;k++){for(var i=0,v=r.length;i<v;i++){if(r[i]==t[k]){break}else{if(i==(v-1)){s.push(t[k])}}}}for(var o=0,u=this.exitTags.length;o<u;o++){p+='<span class="selected">'+r[o]+"</span>"}}for(var l=0,q=s.length;l<q;l++){p+="<span>"+s[l]+"</span>"}d.html(g,"");d.html(g,p)},click:function(){var g=d.get("#tags-edit .tags-edit-box"),h=this;c.on(g,"click",function(k){var j=k.target;if(j.nodeName.toLowerCase()==="span"){try{var i=d.query("#tags-edit .selected").length}catch(k){var i=0}if(d.hasClass(j,"selected")){d.removeClass(j,"selected")}else{if(i==5){alert("\u6700\u591a\u53ea\u80fd5\u4e2a\u6807\u7b7e");return}d.addClass(j,"selected")}h.synchro()}})},synchro:function(){var g=d.get("#J_Tags"),i="";try{a.each(d.query("#tags-edit .tags-edit-box span"),function(k,j){if(d.hasClass(k,"selected")){if(j==0){i=d.html(k)}else{i+=" "+d.html(k)}}});d.val(g,i)}catch(h){return}},submit:function(){var g=d.get(".J_TagsSubmit"),h=d.get("#tagsForm");c.on(g,"click",function(){if(f){setTimeout(function(){h.submit()},0)}else{h.submit()}})}});a.ready(function(g){new b()});return a.Tag=b});KISSY.add("floor",function(a){var f=a.DOM,b=a.Event,h='<div class="citation">',d="</div>",g=['<div class="citation-title clearfix"><span class="user-name">\u539f\u5e16\u7531',"\u697c ",' \u53d1\u8868</span><span class="citation-number">',"</span></div>"];a.Floor={reply:null,init:function(m){if(!m){return}this.reply=m;this.floorReply=this.reply.floorReply;if(!this.floorReply.length){return}var l,k;for(l=0,k=this.floorReply.length;l<k;l++){this.render(l)}},render:function(i){var l=this.floorReply[i],j=l.isTop;if(!!l.isRepeat){this.createRepeat(i,j)}else{this.create(i,j)}},createRepeat:function(o,u){if(this.floorReply[o].replies.length==0){return}var s=u?f.get("#rt"+this.floorReply[o].replyId):f.get("#r"+this.floorReply[o].replyId),r,t=this.floorReply[o].replies,p=t.length,n='<p class="slide-ci"><span class="slide-citation" 	onclick="KISSY.Floor.create('+o+","+u+')" >\u5c55\u5f00\u66f4\u591a\u697c\u5c42<s></s></span></p>',v=g[0]+t[p-1].floor+g[1]+t[p-1].nick+g[2]+p+g[3],w=t[p-1].detail,m=g[0]+t[0].floor+g[1]+t[0].nick+g[2]+1+g[3],q=t[0].detail,l=h+h+h+m+q+d+n+d+v+w+d;f.html(s,l)},create:function(m,u){if(this.floorReply[m].replies.length==0){return}var q=u?f.get("#rt"+this.floorReply[m].replyId):f.get("#r"+this.floorReply[m].replyId),o,n,t=this.floorReply[m].replies,r=t.length,w,s,l,v=[],p;for(o=(r-1);o>=0;o--){w=g[0]+t[o].floor+g[1]+t[o].nick+g[2]+(o+1)+g[3];s=t[o].detail;l=d;if(o==(r-1)){v=[h,w,s,l]}else{v.splice((r-o-1),0,h,w,s,l)}}p=v.join("");f.html(q,"");f.html(q,p)}};try{if(REPLY===undefined||!REPLY){return}a.Floor.init(REPLY)}catch(c){}});KISSY.ready(function(c){var f=c.DOM;var d=f.query(".detail-post");for(var b=0,a=d.length;b<a;b++){f.css(d[b],"z-index",50-b)}});
