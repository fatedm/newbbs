KISSY.ready(function(a){a.getScript("http://a.tbcdn.cn/s/kissy/1.1.6/sizzle/sizzle-pkg-min.js",function(){var e=a.DOM,c=a.Event,d=e.query("img[src*=http://www.atpanel.com/1.gif]")[0];function b(){var h=e.attr(d,"src").split("?"),i=h[0],k,g=h[1].split("&"),j=new Image();for(var f=0;f<g.length;f++){if(g[f].indexOf("pre")!=-1){g.splice(f,1)}}k=i+"?"+g.join("&");j.src=k+"&cachepv="+Math.random()}a.each(a.query(".J-photoWrapper"),function(k){var r=a.query("li",k),p=a.get("img",k),l=a.get(".pw-des"),i=a.get(".des-info",k),m=a.get(".prev",k),j=a.get(".next",k),g=a.get("ul",k),n=e.query("li",g),h=e.offset(k).top;e.css(l,"height",i.offsetHeight);a.each(r,function(t,s){if(e.hasClass(t,"current")){k.currentIndex=s;f(t)}q();c.on(t,"click",function(){f(t)});var u=a.get("a",t);c.on(u,"click",function(v){v.preventDefault()})});if(!k.currentIndex){f(r[0])}function f(u){if(e.hasClass(u,"current")){return}var t=a.get("img",a.get("a",u)),s=a.get("blockquote",u);e.attr(p,"src",e.attr(t,"lazyload"));i.innerHTML=s.innerHTML;r.each(function(v){if(u!==v){e.removeClass(v,"current")}});e.addClass(u,"current");k.currentIndex=a.indexOf(u,r);q();if(a.indexOf(u,r)<=6){m.className="disabled-prev"}else{m.className="prev"}if(Math.ceil((k.currentIndex+1)/7)===Math.ceil(e.query("li",g).length/7)){j.className="disabled-next"}else{j.className="next"}a.Anim(e.parent(i),"height: "+i.offsetHeight+"px",0.2,"easeOut").run();b()}function q(){if(isNaN(k.currentIndex)){k.currentIndex=0}else{k.currentPage=parseInt(k.currentIndex/7,10)}}function o(x){q();var w=k.currentPage,u,s=a.get(".pw-content",k).offsetWidth;if(x=="next"){var v=Math.ceil((r[0].offsetWidth*r.length)/s);if(w<v-1){w++}if(w==1){u=-s}else{u=-(w*s)}}if(x=="prev"){if(w<=1){u=0}else{u=-((w-1)*s)}}var t=(-u)/s;if(t==0){if(x=="next"){f(r[0])}else{f(r[6])}}else{if(x=="next"){f(r[(t*7)])}else{f(r[(t*7)+6])}}a.Anim(g,"left: "+u+"px",0.2,"easeOut").run()}c.on(p,"mouseup",function(A){var v=k.currentIndex,t=v+1,z=v-1,s;if(t>=r.length){t=r.length-1}if(z<0){z=0}s=A.layerX;if(!s){s=A.offsetX}var y=parseInt((k.currentIndex+1)/7,10),w=parseInt((k.currentIndex)/7,10),u=parseInt((k.currentIndex-1)/7,10);if(s<A.currentTarget.offsetWidth/2){if(u<w){o("prev")}else{f(r[z])}}else{if(!e.hasClass(n[t],"current")){if(y>w){o("next")}else{f(r[t])}}}});c.on(p,"mousemove click",function(t){var s=t.layerX;if(!s){s=t.offsetX}if(s&&s>=0){if(s<t.currentTarget.offsetWidth/2&&k.currentIndex!==0){this.className="prev"}if(k.currentIndex===0&&s<t.currentTarget.offsetWidth/2||n.leng<=7){this.className=""}if(s>t.currentTarget.offsetWidth/2&&k.currentIndex!==n.length-1){this.className="next"}if(s>t.currentTarget.offsetWidth/2&&k.currentIndex===n.length-1||n.leng<=7){this.className=""}}});c.on(m,"click",function(s){if(!e.hasClass(this,"disabled-prev")){o("prev")}s.halt()});c.on(j,"click",function(s){if(!e.hasClass(this,"disabled-next")){o("next")}s.halt()});c.on([m,j],"focus",function(){this.blur()})})})});
