var uploadForm={},tabs;KISSY.ready(function(a){var b=a.DOM;tabs=new a.Tabs(".tab-list",{triggerType:"click"});tabs.on("switch",function(d){var c=d.target.content.children;a.each(c,function(e){if(e===c[d.currentIndex]){b.get("input",e).disabled=false}else{b.get("input",e).disabled=true}})})});KISSY.ready(function(d){var f=d.DOM,e=d.Event;uploadForm={insertTitle:function(j){var i=new String(j.substring(j.lastIndexOf("\\")+1)),k=i.substring(0,i.lastIndexOf("."));return i},lastname:function(k){var j=k.value,i=k.parentNode;suffix=k.getAttribute("allowType").toUpperCase(),last=j.split("."),lastThree=last[last.length-1].toUpperCase(),rs=suffix.indexOf(lastThree),showInfoObj=document.getElementById("show-info"),fileName=uploadForm.insertTitle(j),showTxtObj=f.next(f.parent(k));if(rs<0){uploadForm.showInfo(k,"\u9009\u9519\u5566\uff0c\u60a8\u53ea\u80fd\u9009\u62e9 <b>"+suffix+"</b> \u683c\u5f0f\u7684\u6587\u4ef6\uff01");var l='<input type="file" size="50" allowtype=" '+suffix+' " id="'+k.id+'" name="'+k.name+'">';i.innerHTML=l;e.on(f.get("input",i),"change",function(){uploadForm.lastname(this)})}else{if(!fileName){fileName=j}uploadForm.showInfo(k);return false}},showInfo:function(j,i){var l=f.next(f.parent(j)),k=f.get("p",l);if(i&&i.length>0){f.html(k,i);d.Anim(l,{opacity:"1",height:"25px"},0.3,"easeIn").run()}else{d.Anim(l,{opacity:"0",height:"0"},0.3,"easeOut").run()}},updateSummary:function(){var j=f.get("#summary-hidden"),i=window.top.KISSY.DOM;j.value=i.query("li",i.get("#picListItem")).length},getParentHidden:function(){var j=document.forms["upload-pic"],n=j.groupId,p=j.uuid,i=j.threadId,l=window.top.KISSY.DOM,o=l.get("#J_groupId"),m=l.get("#J_uuid"),k=l.get("#J_threadId");n.value=o.value;p.value=m.value;i.value=k.value},returnThumbnail:function(j){var l=j.lastIndexOf("."),k=j.substring(0,l),i=j.substring(l,j.length);return j+"_110x110.jpg"}};e.on([f.get("#zip-file"),f.get("#pic-file")],"change",function(){uploadForm.lastname(this)});e.on(document.forms["upload-pic"],"submit",function(i){i.halt(true)});e.on(f.get("#upload-file"),"click",function(j){uploadForm.updateSummary();uploadForm.getParentHidden();var i=f.get("input",f.get("p.file",tabs.panels[tabs.activeIndex]));if(i.value.length<1){uploadForm.showInfo(i,"\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u6587\u4ef6\uff0c\u8bf7\u9009\u62e9\uff1a"+f.attr(i,"allowType")+"\u683c\u5f0f\u7684\u6587\u4ef6\uff01");j.halt(true);return false}d.getScript(isLoginAddress,function(){if(loginStatus===1){document.forms["upload-pic"].submit()}else{window.top.location.href=loginAddress+window.top.location.href}},"gb2312")});var c=window.top.document.getElementById("iframe-upload"),b=f.get("#demo");window.setTimeout(function(){window.setInterval(function(){if(c){c.height=b.offsetHeight}},100)},1);var a=window.top.KISSY.DOM,h=a.get("#upload-info p");if(errorMessage.length>1){a.removeClass(h,"hidden");a.html(h,errorMessage)}else{a.addClass(h,"hidden")}function g(){var m=KISSY,j=m.DOM,t=m.Event,q=picJSON.list,p,s,l=window.top.document.getElementById("picListItem"),k,r=j.query("li",l),o=window.top.document.createDocumentFragment();if(r.length>=30){k=0}else{k=30-r.length;if(!r.length||r.length<1){k=30}var n=0;for(Item in q){if(n>=k){break}s=q[Item];p=window.top.KISSY.DOM.create('<li><p class="del"><input type="checkbox" class="del" /></p><p class="pic"><b><img src="'+uploadForm.returnThumbnail(s.imageUrl)+'" /><u></u></b><a class="del">\u5220\u9664</a></p><p class="des"><textarea></textarea><span>\u5df2\u7ecf\u8f93\u5165<b></b>\u4e2a\u5b57\uff0c\u8fd8\u53ef\u4ee5\u8f93\u5165<em></em>\u4e2a\u5b57\u3002</span><input type="checkbox" class="des" name="des" value="" checked="checked" /><input type="checkbox" class="address" name="address" value="'+s.imageUrl+'" checked="checked" /></p><p class="control"><a class="up" href="#prev"></a><a class="down" href="#next"></a></p></li>');o.appendChild(p);n++}if(k===30){l.appendChild(o)}else{j.insertBefore(o,j.get("li",l))}}if(window.top.uploadObj&&window.top.uploadObj.statisticsRemainingNum){window.top.uploadObj.statisticsRemainingNum()}if(window.top.uploadObj&&window.top.uploadObj.resetCharactor){window.top.uploadObj.resetCharactor()}if(window.top.uploadObj&&window.top.uploadObj.removeFirstEndLi){window.top.uploadObj.removeFirstEndLi()}if(window.top.uploadObj&&window.top.uploadObj.keepChkStatus){window.top.uploadObj.keepChkStatus()}uploadForm.updateSummary()}g()});
