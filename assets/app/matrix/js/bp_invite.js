(function(){var I=YAHOO.util,F=I.Event,H=I.Dom,B,A=true,G="",C={login:function(){if(TB.bom.getCookie("cookie1")==""&&TB.bom.getCookie("_l_g_")==""){H.setStyle("J_InvitePop","display","none");H.setStyle("J_InvitePop","visibility","hidden");if(!$("J_PopUpMask")){var D=document.createElement("div");D.id="J_PopUpMask";D.className="pop-up";D.style.position="absolute";D.style.left=H.getStyle("J_InvitePop","left");D.style.top=H.getStyle("J_InvitePop","top");H.setStyle(D,"z-index","100000");D.innerHTML='<div class=\'hd\'><h3 id=\'J_title\'></h3></div><div class="bd"><div class="inner"><iframe id="J_PopUpFrame" class="pop-mask" src="" scrolling="no" frameborder="0"></iframe></div></div><p class="ft"><a href="#" class="j_close act" >\u5173\u95ed</a></p>';document.body.appendChild(D);var J=H.get("J_PopUpFrame");H.setStyle(J,"height","auto");H.setStyle(D,"display","block");J.setAttribute("src","/invitation/sns_friends.htm?group_id="+B+"&t="+new Date().getTime());var K=H.getElementsByClassName("j_close");F.on(K,"click",function(L){H.setStyle(D,"display","none");H.setStyle("J_InvitePop","display","none");E.cancel();F.stopEvent(L)})}else{var D=$("J_PopUpMask")}H.setStyle(D,"display","block");var E=YAHOO.lang.later(1,window,function(){if((TB.bom.getCookie("cookie1")||TB.bom.getCookie("_l_g_"))!=""){H.setStyle(D,"display","none");C.viewAll();E.cancel();return true}},null,true);return true}return false},viewAll:function(){if(C.login()){return }var E="/invitation/sns_friends.htm?group_id="+B+"&t="+new Date().getTime();var D=I.Get.script(E,{onSuccess:function(Q){if(!(typeof _result=="undefined")&&_result){var T=_result.groupList;var V=_result.friendList;var J=H.getElementsByClassName("f-area","div","J_InvitePop")[0];if(_result.message!=""){G=J.innerHTML;J.innerHTML="<p>"+_result.message+"</p>";return false}if(V.length==0){G=J.innerHTML;J.innerHTML='<p>\u8fd8\u53ea\u8eab\u4e00\u4eba\u5728\u6c5f\u6e56\u98d8\u7740\uff1f\u4f60\u76ee\u524d\u4e00\u4e2a\u597d\u53cb\u90fd\u6ca1\u6709\uff01\u5feb\u53bb<a href="'+$("J_InvitePop").getAttribute("data:jhurl")+'" target="_blank">\u9080\u8bf7\u597d\u53cb</a></p>';return false}if(!$("J_AllFri")&&G!=""){J.innerHTML=G;F.on("J_SureInvite","click",C.submitForm);var P=H.getElementsByClassName("act-cancel","button","J_InvitePop");F.on(P,"click",function(Z){var Y=F.getTarget(Z);var X=H.getAncestorByClassName(Y,"invite-f");H.setStyle(X,"display","none");F.preventDefault(Z)})}$("J_AllGroup").innerHTML="";var O=document.createDocumentFragment();var L=document.createElement("option");L.setAttribute("value","all");L.appendChild(document.createTextNode("\u5168\u90e8\u597d\u53cb"));O.appendChild(L);for(var M=0;M<T.length;M++){_op=document.createElement("option");_op.setAttribute("value",T[M].groupId);_op.appendChild(document.createTextNode(T[M].groupName));O.appendChild(_op)}$("J_AllGroup").appendChild(O);F.on("J_AllGroup","change",C.changeGroup);$("J_AllFri").innerHTML="";var U=document.createDocumentFragment(),R;for(var K=0;K<V.length;K++){var N=document.createElement("li");N.setAttribute("data:fid",V[K].friendId);N.setAttribute("data:gid",V[K].groupIds);N.innerHTML='<label for="f_'+K+'"><input id="f_'+K+'" value="'+V[K].friendId+'" type="checkbox" />'+V[K].friendNick+"</label>";U.appendChild(N)}$("J_AllFri").appendChild(U);F.removeListener("c_all");var W=$("J_AllFri").getElementsByTagName("input");F.removeListener(W);F.on(W,"click",C.checkInput);var S=TB.form.CheckboxGroup.attach(W,{checkAllBox:"c_all",checkOnInit:true})}},onFailure:function(J){alert("\u672a\u77e5\u9519\u8bef")},charset:"GBK"});if(A){A=false;F.on("J_SureInvite","click",C.submitForm)}H.setStyle("J_InvitePop","visibility","visible");H.setStyle("J_InvitePop","display","block");H.setStyle("J_InvitePop","z-index","100000")},checkInput:function(){var E=H.getElementsBy(function(J){return H.isAncestor("J_AllFri",J)&&J.tagName.toLowerCase()=="input"&&H.getAncestorByTagName(J,"li").style.display!="none"});var D=TB.common.toArray(E).every(function(K,J){return K.checked==true});setTimeout(function(){D?($("c_all").checked=true):($("c_all").checked=false)},100)},changeGroup:function(L){var K=F.getTarget(L);var J=K.value;var D=H.get("J_AllFri").getElementsByTagName("li");if(J=="all"){H.setStyle(D,"display","block")}else{TB.common.toArray(D).forEach(function(N,M){H.setStyle(N,"display","block");if(N.getAttribute("data:gid").split(",").indexOf(J)<0){H.setStyle(N,"display","none")}})}var E=$("J_InvitePop").getElementsByTagName("input");TB.common.toArray(E).forEach(function(N,M){N.checked=false})},submitForm:function(K){F.preventDefault(K);if(C.login()){return }var J=$("J_AllFri").getElementsByTagName("input");var L=[];TB.common.toArray(J).forEach(function(N,M){H.getStyle(H.getAncestorByTagName(N,"li"),"display")!="none"&&N.checked==true&&L.push(N.value);H.getStyle(H.getAncestorByTagName(N,"li"),"display")=="none"&&(N.checked=false)});if(L.length==0){alert("\u8bf7\u9009\u62e9\u597d\u53cb");return }var D="friends="+L.join(",")+"&action=invitation_action&event_submit_do_invite_sns_friends=anything&groupId="+B+"&tbToken="+$("J_InvitePop").getAttribute("data:tbToken");var E=$("J_InvitePop").getAttribute("data:submitUrl")+"?_input_charset=utf-8";I.Connect.asyncRequest("POST",E,{success:function(O){var M=YAHOO.lang.JSON.parse(O.responseText);var N=H.getElementsByClassName("f-area","div","J_InvitePop")[0];G=N.innerHTML;M.result==0?(N.innerHTML='<p class="success">\u606d\u559c\u4f60\uff01\u5df2\u7ecf\u6210\u529f\u5411\u597d\u53cb\u53d1\u51fa\u9080\u8bf7\uff01</p>'):(N.innerHTML='<p class="error">'+M.result+"</p>");setTimeout(function(){location.reload(true)||location.reload()},3000)},failure:function(M){commonAjaxFailure(M)}},D)},init:function(){if(!$("J_InvitePop")){return }var E=H.getElementsByClassName(/act-close|act-cancel/,"*","J_InvitePop");F.on(E,"click",function(L){var K=F.getTarget(L);var J=H.getAncestorByClassName(K,"invite-f");H.setStyle(J,"display","none");H.setStyle(J,"visibility","hidden");F.preventDefault(L)});H.setStyle("J_InvitePop","visibility","hidden");var D=$("J_InviteFri")?$("J_InviteFri"):H.getElementsByClassName("J_InviteFri");F.on(D,"click",function(J){B=F.getTarget(J).getAttribute("data:groupId")});TB.widget.SimplePopup.decorate(D,"J_InvitePop",{position:"top",eventType:"click",width:390,align:"right",offset:[49,-20],onShow:function(){setTimeout(function(){C.viewAll()},100)}})}};C.init()})();
